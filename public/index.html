<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Book searcher</title>
  </head>
  <body>
    <form onsubmit="event.preventDefault(); handleSearch()">
      <input
        id="queryInput"
        name="query"
        placeholder="Search"
        value=""
        autofocus
      />
    </form>

    <div id="result"></div>

    <script>
      async function handleSearch() {
        const query = queryInput.value;

        queryInput.disabled = true;
        result.innerText = "";

        try {
          const found = await searchBook(query);

          console.log(found);
          const ul = document.createElement("ul");

          for (const entry of found) {
            const li = document.createElement("li");
            const a = document.createElement("a");

            a.innerText = `${entry.authors} - ${entry.title} (${entry.lang})`;
            a.href = `/dl/${entry.id}`;

            li.appendChild(a);
            ul.appendChild(li);
          }

          result.appendChild(ul);
        } finally {
          queryInput.disabled = false;
        }
      }

      function searchBook(q) {
        return fetch(`/api/search?q=${q}`).then((r) =>
          r.ok ? r.json() : null
        );
      }
    </script>
  </body>
</html>
